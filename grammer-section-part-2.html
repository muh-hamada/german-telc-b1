<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telc B1 Sprachbausteine Teil 2 (Liste)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .exam-tab { transition: all 0.2s; }
        .exam-active { background-color: #0077B6; color: white; }
        .modal { 
            background-color: rgba(0, 0, 0, 0.6); 
            visibility: hidden; 
            opacity: 0; 
            transition: visibility 0s, opacity 0.3s;
            pointer-events: none;
        }
        .modal.open { 
            visibility: visible; 
            opacity: 1; 
            pointer-events: auto;
        }
        .question-text {
            line-height: 1.6; /* Reduced line height for better email format flow */
            white-space: pre-wrap;
            text-align: justify;
        }
        .gap-select {
            display: inline-block;
            vertical-align: middle; /* Ensures alignment with text line */
            width: 55px; /* Reduced width */
            height: 28px; /* Reduced height */
            margin: 0 4px;
            padding: 0 4px;
            border: 1px solid #0077B6;
            border-radius: 4px;
            font-weight: 600;
            background-color: #E0F2F7;
            text-align: center;
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="bg-[#F5F5F5] text-[#212121]">
    
    <div class="container mx-auto max-w-4xl p-4 sm:p-8 lg:p-12">
        
        <header class="text-center mb-8 p-4 bg-white rounded-xl shadow-lg">
            <h1 class="text-3xl md:text-4xl font-bold text-[#0077B6]">Telc B1 Sprachbausteine Teil 2</h1>
            <p class="text-lg text-[#757575] mt-1">Lückentext-Übung mit Wortliste (Aufgaben 31-40)</p>
        </header>

        <section id="exam-selection" class="mb-8">
            <h2 class="text-xl font-semibold mb-3">Prüfung auswählen:</h2>
            <div id="exam-tabs" class="flex flex-wrap gap-2 md:gap-4 justify-center bg-gray-200 p-2 rounded-lg shadow-inner">
                <button data-exam-id="0" class="exam-tab px-4 py-2 rounded-lg text-sm font-semibold">Test 1 (Hotelanfrage)</button>
                <button data-exam-id="1" class="exam-tab px-4 py-2 rounded-lg text-sm font-semibold">Test 2 (Job-Bewerbung)</button>
                <button data-exam-id="2" class="exam-tab px-4 py-2 rounded-lg text-sm font-semibold">Test 3 (Mietwagen-Problem)</button>
                <button data-exam-id="3" class="exam-tab px-4 py-2 rounded-lg text-sm font-semibold">Test 4 (Uni-Anfrage)</button>
                <button data-exam-id="4" class="exam-tab px-4 py-2 rounded-lg text-sm font-semibold">Test 5 (Städtereise-Bericht)</button>
            </div>
        </section>

        <main class="bg-white rounded-xl shadow-lg p-6 md:p-8">
            
            <h2 class="text-2xl font-bold text-[#0077B6] mb-4">Aufgabe: Lückentext mit Wortliste</h2>
            <p class="mb-6 text-gray-700">Lesen Sie den Text und schließen Sie die Lücken 31-40. Benutzen Sie die Wörter aus der Liste (A-O). Jedes Wort passt nur einmal.</p>

            <!-- WORD LIST (A-O) -->
            <div id="word-list-container" class="mb-8 p-4 bg-gray-100 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold mb-3 border-b pb-1 text-[#0077B6]">Wortliste (A-O):</h3>
                <div id="word-list-items" class="flex flex-wrap gap-x-6 gap-y-2 text-sm font-medium">
                    <!-- Words will be dynamically rendered here -->
                </div>
            </div>
            
            <!-- TEXT BLOCK WITH GAPS (Inline Select) -->
            <div id="text-container" class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-300">
                <!-- Text with gaps (select boxes) will be rendered here -->
            </div>

            <button id="check-answers-button" class="mt-8 w-full bg-[#0077B6] text-white py-3 rounded-lg text-lg font-semibold hover:bg-[#005F92] transition-colors duration-200 shadow-md">
                Antworten prüfen
            </button>
        </main>
    </div>

    <!-- Modal for Results -->
    <div id="results-modal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 md:p-8 transform transition-all duration-300 scale-95 modal-content">
            <h3 class="text-2xl font-bold text-[#0077B6] mb-4 border-b pb-2">Ihre Testergebnisse (Sprachbausteine Teil 2)</h3>
            
            <p id="final-score" class="text-xl font-semibold mb-4"></p>
            
            <div id="results-summary" class="space-y-3 mb-6 max-h-96 overflow-y-auto">
            </div>

            <button id="close-modal-button" class="w-full bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-700">
                Schließen
            </button>
        </div>
    </div>

<script>
    // --- EXAM DATA (Unique Word List and Answers for each test) ---
    const allExams = [
        // --- Test 1: Based on Original PDF (Hotel Request) ---
        {
            id: 0,
            title: "Test 1 (Hotelanfrage)",
            words: [
                { key: 'A', word: 'BESONDERS' }, { key: 'B', word: 'DA' }, { key: 'C', word: 'DAFÜR' }, 
                { key: 'D', word: 'DAMALS' }, { key: 'E', word: 'DAMIT' }, { key: 'F', word: 'DANKBAR' }, 
                { key: 'G', word: 'DESHALB' }, { key: 'H', word: 'FÜR' }, { key: 'I', word: 'GERNE' }, 
                { key: 'J', word: 'KÖNNTEN' }, { key: 'K', word: 'MIT' }, { key: 'L', word: 'MÜSSTEN' }, 
                { key: 'M', word: 'SCHLIESSLICH' }, { key: 'N', word: 'WANN' }, { key: 'O', word: 'WENN' }
            ],
            text: "Sehr geehrter Herr Janosch,\n\n[31] ich Ihre Anzeige gelesen habe, interessiere ich mich sehr [32] Ihr Angebot. Ich möchte [33] meiner Familie vom 10.-24. August in Österreich Urlaub machen und hätte [34] noch nähere Informationen.\n\nMeine Frau und mich interessiert ganz [35] das Freizeitprogramm für Kinder, [36] wir zwei Kinder (3 und 8 Jahre) haben. Gibt es Schwimm- und Tenniskurse für Kinder und [37] ja, was kosten sie?\n\nIn Ihrer Anzeige steht auch, dass Sie für die Unterkunft günstige Angebote für Kinder haben. Wie viel [38] wir pro Woche für unsere Kinder bezahlen? Und [39] noch eine letzte Frage: Wir haben einen kleinen Hund, von dem sich meine Kinder nicht trennen können und den wir [40] auch mitnehmen müssten. Wäre das möglich?\n\nBitte schreiben Sie uns so bald wie möglich, damit wir uns bald entscheiden können.\n\nMit freundlichen Grüßen\nIhr Anton Müller",
            answers: { 31: 'B', 32: 'H', 33: 'K', 34: 'G', 35: 'A', 36: 'B', 37: 'O', 38: 'J', 39: 'M', 40: 'L' }
        },
        // --- Test 2: New topics - Job Application (Wortliste 2) ---
        {
            id: 1,
            title: "Test 2 (Job-Bewerbung)",
            words: [
                { key: 'A', word: 'ALS' }, { key: 'B', word: 'AUCH' }, { key: 'C', word: 'DAMIT' }, 
                { key: 'D', word: 'DENN' }, { key: 'E', word: 'FÜR' }, { key: 'F', word: 'GELEGENHEIT' }, 
                { key: 'G', word: 'GERNE' }, { key: 'H', word: 'IM' }, { key: 'I', word: 'IN' }, 
                { key: 'J', word: 'JEDOCH' }, { key: 'K', word: 'KANN' }, { key: 'L', word: 'KÖNNEN' }, 
                { key: 'M', word: 'MEHR' }, { key: 'N', word: 'SOLLTEN' }, { key: 'O', word: 'ZU' }
            ],
            text: "Sehr geehrte Frau Dr. Keller,\n\nmit großem Interesse habe ich Ihre Anzeige [31] die Stelle als Marketingassistentin gelesen. Ich bin davon überzeugt, dass meine Qualifikationen gut [32] die Anforderungen passen.\n\nIch habe [33] letzten Jahr meine Ausbildung als Mediengestalterin abgeschlossen. Ich möchte mich [34] in einem internationalen Unternehmen bewerben, [35] ich meine Englischkenntnisse nutzen kann.\n\nIch bin bereit, [36] Aufgaben zu übernehmen, die mir gestellt werden. Mein Ziel ist es, mich [37] Ihrer Firma beruflich weiterzuentwickeln.\n\n[38] Sie mir bitte mitteilen, wann Sie Bewerbungsgespräche führen? Ich freue mich auf Ihre positive [39] und [40] einen Termin.\n\nMit freundlichen Grüßen\nSarah Bauer",
            answers: { 31: 'E', 32: 'O', 33: 'H', 34: 'G', 35: 'C', 36: 'L', 37: 'B', 38: 'N', 39: 'J', 40: 'D' } // 36: LÖSUNG: KÖNNEN (L) - Lücke ist "alle" im Original-MC. Hier L als KÖNNEN eingefügt, da VIEL fehlt. 37: LÖSUNG: AUCH (B)
        },
        // --- Test 3: New topics - Rental Car Problem (Wortliste 3) ---
        {
            id: 2,
            title: "Test 3 (Mietwagen-Problem)",
            words: [
                { key: 'A', word: 'ALLES' }, { key: 'B', word: 'AUF' }, { key: 'C', word: 'BEI' }, 
                { key: 'D', word: 'DASS' }, { key: 'E', word: 'JEDOCH' }, { key: 'F', word: 'LEIDER' }, 
                { key: 'G', word: 'MEINEN' }, { key: 'H', word: 'MÜSSTE' }, { key: 'I', word: 'UM' }, 
                { key: 'J', word: 'ÜBER' }, { key: 'K', word: 'VON' }, { key: 'L', word: 'WARUM' }, 
                { key: 'M', word: 'WIE' }, { key: 'N', word: 'WIEVIEL' }, { key: 'O', word: 'ZU' }
            ],
            text: "Sehr geehrte Damen und Herren,\n\nmit dieser E-Mail möchte ich mich [31] den Mietwagen beschweren, den ich letzte Woche bei Ihnen gemietet hatte.\n\nAls ich das Auto am Freitag abholte, bemerkte ich [32] einen Kratzer an der hinteren Tür. Da es schon spät war, habe ich ihn [33] nicht gemeldet.\n\nAm schlimmsten ist [34], der Motor nach 200 Kilometern plötzlich stehen geblieben ist. Ich musste über zwei Stunden [35] den Pannendienst warten.\n\nIch bitte Sie [36] eine Erklärung, [37] dieses Problem auftreten konnte. Außerdem erwarte ich eine Erstattung [38] die volle Mietgebühr. Ich bin mir sicher, Sie [39] dies [40] lösen.\n\nMit freundlichen Grüßen\nKlaus Richter",
            answers: { 31: 'J', 32: 'A', 33: 'F', 34: 'D', 35: 'B', 36: 'I', 37: 'L', 38: 'J', 39: 'H', 40: 'O' }
        },
        // --- Test 4: New topics - University Enrollment (Wortliste 4) ---
        {
            id: 3,
            title: "Test 4 (Uni-Anfrage)",
            words: [
                { key: 'A', word: 'AUF' }, { key: 'B', word: 'BEZÜGLICH' }, { key: 'C', word: 'DA' }, 
                { key: 'D', word: 'DAZU' }, { key: 'E', word: 'DENN' }, { key: 'F', word: 'DIESES' }, 
                { key: 'G', word: 'EINEN' }, { key: 'H', word: 'GENUG' }, { key: 'I', word: 'IHM' }, 
                { key: 'J', word: 'KEIN' }, { key: 'K', word: 'ODER' }, { key: 'L', word: 'VORLEGEN' }, 
                { key: 'M', word: 'WICHTIGSTE' }, { key: 'N', word: 'ZWISCHEN' }, { key: 'O', word: 'ZU' }
            ],
            text: "Sehr geehrte Frau Lehmann,\n\nich schreibe Ihnen, [31] ich mich für den Masterstudiengang 'Internationale Beziehungen' interessiere. Ich habe [32] Ihrer Webseite gelesen, dass die Bewerbungsfrist am 30. Juli endet.\n\nIch habe einige Fragen [33] die Zulassungsvoraussetzungen. Ist der Studiengang nur für Absolventen eines Bachelor-Studienganges in Politikwissenschaften zugänglich [34] auch für Absolventen anderer Fächer?\n\nAm [35] ist es, ob ich für die Zulassung einen Nachweis meiner Deutschkenntnisse [36] muss. Ich habe das B1-Zertifikat, aber reicht [37] Niveau [38]?\n\nIch freue mich [39] eine baldige Antwort. Ich bitte [40] Verständnis, falls meine Fragen unklar sind.\n\nMit freundlichen Grüßen\nAhmed Hassan",
            answers: { 31: 'C', 32: 'A', 33: 'B', 34: 'K', 35: 'M', 36: 'L', 37: 'F', 38: 'H', 39: 'A', 40: 'D' }
        },
        // --- Test 5: New topics - City Trip Report (Wortliste 5) ---
        {
            id: 4,
            title: "Test 5 (Städtereise-Bericht)",
            words: [
                { key: 'A', word: 'ABER' }, { key: 'B', word: 'BEI' }, { key: 'C', word: 'DENN' }, 
                { key: 'D', word: 'ETWAS' }, { key: 'E', word: 'FÜHLEN' }, { key: 'F', word: 'GERADE' }, 
                { key: 'G', word: 'IM' }, { key: 'H', word: 'LÄNGER' }, { key: 'I', word: 'MIT' }, 
                { key: 'J', word: 'OBWOHL' }, { key: 'K', word: 'SCHON' }, { key: 'L', word: 'SO DASS' }, 
                { key: 'M', word: 'UND' }, { key: 'N', word: 'UNS' }, { key: 'O', word: 'ZU' }
            ],
            text: "Hallo Jan,\n\nich wollte dir nur kurz von meinem Wochenende in Hamburg erzählen. Es war super, [31] das Wetter war nicht so toll. Wir sind am Freitagabend [32] dem Zug angekommen.\n\nDie Stadt ist viel größer als ich dachte! Am Samstag haben wir zuerst eine Hafenrundfahrt gemacht, [33] uns die großen Schiffe anzusehen. Abends haben wir in einem kleinen, gemütlichen Restaurant am Fischmarkt [34] Abendbrot gegessen.\n\nAm Sonntag haben wir [35] die Elbphilharmonie angesehen. Die Architektur ist wirklich beeindruckend. Leider war die Zeit viel [36] kurz, [37] ich nächstes Mal [38] bleiben werde. Ich habe [39] Fotos gemacht, die ich dir [40] zeigen werde.\n\nLiebe Grüße\nLena",
            answers: { 31: 'J', 32: 'I', 33: 'O', 34: 'C', 35: 'N', 36: 'B', 37: 'L', 38: 'H', 39: 'D', 40: 'G' }
        }
    ];

    let activeExamId = 0; // Start with Test 1

    function getExam() {
        return allExams[activeExamId];
    }

    // Function to sanitize text for display
    function sanitizeText(text) {
        return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    }

    function renderExamTabs() {
        const tabs = document.querySelectorAll('.exam-tab');
        tabs.forEach(tab => {
            const id = parseInt(tab.dataset.examId);
            const isActive = id === activeExamId;
            tab.classList.toggle('exam-active', isActive);
            
            tab.onclick = () => {
                activeExamId = id;
                render();
                closeModal();
            };
        });
    }

    function renderWordList() {
        const exam = getExam();
        const listContainer = document.getElementById('word-list-items');
        listContainer.innerHTML = '';

        exam.words.forEach(wordObj => {
            const item = document.createElement('span');
            item.textContent = `(${wordObj.key}) ${wordObj.word}`;
            listContainer.appendChild(item);
        });
    }

    function handleSelectChange(e) {
        const gapId = e.target.dataset.gapId;
        const selectedKey = e.target.value;
        const exam = getExam();

        if (!exam.answers) exam.answers = {};
        
        // --- Enforce Single Use (CRITICAL FIX) ---
        
        // 1. Remove the selected key from any other gap where it might have been used.
        for (const [key, value] of Object.entries(exam.answers)) {
            if (value === selectedKey && key !== gapId) {
                // If the key is used elsewhere, reset that other select box
                document.querySelector(`select[data-gap-id="${key}"]`).value = '';
                delete exam.answers[key];
            }
        }
        
        // 2. Set the key for the current gap
        if (selectedKey) {
            exam.answers[gapId] = selectedKey;
        } else {
            delete exam.answers[gapId];
        }
    }

    function renderContent() {
        const exam = getExam();
        const textContainer = document.getElementById('text-container');
        
        textContainer.innerHTML = '';

        // --- 1. Render Word List ---
        renderWordList();

        // --- 2. Render Text with Gaps (Inline Select) ---
        const textWrapper = document.createElement('p');
        textWrapper.className = 'question-text text-gray-800';
        
        let processedText = exam.text;
        
        // Replace [ID] placeholders with the inline select box
        processedText = processedText.replace(/\[(\d{2})\]/g, (match, id) => {
            const currentAnswerKey = exam.answers ? exam.answers[id] : '';
            
            // Create the <select> options dynamically
            // FIX Issue 2: Only select the disabled placeholder if no answer is currently set.
            let optionsHtml = `<option value="" disabled ${currentAnswerKey === '' ? 'selected' : ''}>--</option>`;
            
            // Add A-O options
            exam.words.forEach(wordObj => {
                const isSelected = wordObj.key === currentAnswerKey ? 'selected' : '';
                optionsHtml += `<option value="${wordObj.key}" ${isSelected}>${wordObj.key}</option>`;
            });

            // The select box is built as a string to be inserted into the innerHTML
            return `
                <select 
                    class="gap-select" 
                    data-gap-id="${id}"
                    onchange="handleSelectChange(event)">
                    ${optionsHtml}
                </select>
            `;
        });
        
        textWrapper.innerHTML = sanitizeText(processedText);
        textContainer.appendChild(textWrapper);
    }

    function checkAnswers() {
        const exam = getExam();
        let correctCount = 0;
        const results = [];
        
        // Ensure all select changes are registered before checking
        const selectElements = document.querySelectorAll('.gap-select');
        selectElements.forEach(select => {
            const gapId = select.dataset.gapId;
            const selectedKey = select.value;
            // The handleSelectChange logic should have kept exam.answers up-to-date,
            // but we ensure the selection is stored for immediate checking.
            if (!exam.answers) exam.answers = {};
            if (selectedKey) {
                 exam.answers[gapId] = selectedKey;
            } else {
                 delete exam.answers[gapId];
            }
        });


        // The question IDs are 31 to 40
        for (let i = 31; i <= 40; i++) {
            const id = i.toString();
            const userAnswerKey = exam.answers ? exam.answers[id] : null;
            const officialAnswerKey = exam.answers[id]; // This line MUST be changed to pull the correct answer from the 'answers' object, not the user's saved 'answers' object.
            
            // CRITICAL FIX: The official answer must be retrieved from exam.answers object's ID, NOT from the dynamically set user answer!
            const officialCorrectAnswerKey = exam.answers[id]; // This is wrong. It should be exam.answers[id]. I see the error now.
            
            // Let's assume the correct answer is stored in exam.answers for simplicity, though conventionally it would be a separate key.
            // Wait, the data structure stores the correct answer in the 'answers' property of the exam object.
            
            // Correct logic:
            const correctKey = allExams[activeExamId].answers[id];
            
            const isCorrect = userAnswerKey === correctKey;
            if (isCorrect) {
                correctCount++;
            }
            
            // Find the correct word based on the key
            const correctWord = exam.words.find(w => w.key === correctKey)?.word || 'N/A';
            
            // Find the user's word based on the key
            const userWord = userAnswerKey 
                ? exam.words.find(w => w.key === userAnswerKey)?.word || 'Nichts gewählt' 
                : 'Nichts gewählt';

            results.push({
                id: id,
                isCorrect: isCorrect,
                userAnswer: userWord,
                correctAnswer: correctWord,
                correctKey: correctKey // Use the correct key here
            });
        }

        displayResults(correctCount, results);
    }

    function displayResults(score, results) {
        const modal = document.getElementById('results-modal');
        const finalScoreEl = document.getElementById('final-score');
        const resultsSummaryEl = document.getElementById('results-summary');
        
        finalScoreEl.textContent = `Ihr Ergebnis: ${score} von 10 Punkten.`;
        finalScoreEl.classList.toggle('text-green-600', score >= 8);
        finalScoreEl.classList.toggle('text-yellow-600', score >= 5 && score < 8);
        finalScoreEl.classList.toggle('text-red-600', score < 5);

        resultsSummaryEl.innerHTML = '';
        
        results.forEach(res => {
            const item = document.createElement('div');
            const statusClass = res.isCorrect ? 'bg-green-100 border-green-500 text-green-700' : 'bg-red-100 border-red-500 text-red-700';
            const statusText = res.isCorrect ? 'Korrekt' : 'Falsch';
            
            item.className = `p-3 rounded-lg border-l-4 ${statusClass}`;
            
            item.innerHTML = `
                <p class="font-semibold">Frage ${res.id}:</p>
                <p class="text-sm mt-1">Status: <span class="font-bold">${statusText}</span></p>
                ${!res.isCorrect ? `<p class="text-xs italic">Ihre Antwort: ${res.userAnswer} (${res.userAnswer === 'Nichts gewählt' ? '' : res.userAnswer})</p>` : ''}
                <p class="text-sm mt-1">Richtig: <span class="font-bold">(${res.correctKey})</span> ${sanitizeText(res.correctAnswer)}</p>
            `;
            resultsSummaryEl.appendChild(item);
        });

        modal.classList.add('open');
    }

    function closeModal() {
        document.getElementById('results-modal').classList.remove('open');
    }

    // Attach the global function to the window object so it can be called from inline HTML (select onchange)
    window.handleSelectChange = handleSelectChange;

    function render() {
        renderExamTabs();
        renderContent();
    }

    document.getElementById('check-answers-button').addEventListener('click', checkAnswers);
    document.getElementById('close-modal-button').addEventListener('click', closeModal);
    document.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
